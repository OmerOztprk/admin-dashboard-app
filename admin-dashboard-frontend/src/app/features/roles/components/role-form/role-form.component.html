<div class="container mt-4">
  <div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h5 class="mb-0">{{ isEditMode ? 'Rolü Düzenle' : 'Yeni Rol Ekle' }}</h5>
      <button class="btn btn-secondary btn-sm" (click)="cancel()">
        <i class="bi bi-arrow-left"></i> Geri Dön
      </button>
    </div>
    <div class="card-body">
      <!-- Error Message -->
      <div *ngIf="error" class="alert alert-danger">
        {{ error }}
      </div>
      
      <!-- Loading -->
      <div *ngIf="loading" class="d-flex justify-content-center">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Yükleniyor...</span>
        </div>
      </div>
      
      <!-- Role Form -->
      <form [formGroup]="roleForm" (ngSubmit)="onSubmit()" *ngIf="!loading">
        <div class="mb-3">
          <label for="role_name" class="form-label">Rol Adı</label>
          <input 
            type="text" 
            class="form-control" 
            id="role_name" 
            formControlName="role_name"
            [ngClass]="{'is-invalid': roleForm.get('role_name')?.invalid && roleForm.get('role_name')?.touched}"
          >
          <div class="invalid-feedback" *ngIf="roleForm.get('role_name')?.errors?.['required']">
            Rol adı gereklidir.
          </div>
          <div class="invalid-feedback" *ngIf="roleForm.get('role_name')?.errors?.['minlength']">
            Rol adı en az 3 karakter olmalıdır.
          </div>
        </div>
        
        <div class="mb-3">
          <label class="form-label">İzinler</label>
          <div class="invalid-feedback d-block" *ngIf="roleForm.get('permissions')?.invalid && roleForm.get('permissions')?.touched">
            En az bir izin seçilmelidir.
          </div>
          
          <div class="row">
            <div class="col-md-4 mb-3" *ngFor="let group of permissionGroups">
              <div class="card">
                <div class="card-header">{{ group.name }}</div>
                <div class="card-body">
                  <div class="form-check" *ngFor="let permission of $any(group.permissions)">
                    <input 
                      class="form-check-input" 
                      type="checkbox" 
                      [id]="permission.key"
                      [checked]="isPermissionSelected(permission.key)"
                      (change)="togglePermission(permission.key, $event)"
                    >
                    <label class="form-check-label" [for]="permission.key">
                      {{ permission.name }}
                      <small class="text-muted d-block">{{ permission.description }}</small>
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="mb-3">
          <button type="submit" class="btn btn-primary" [disabled]="roleForm.invalid || submitting">
            <span *ngIf="submitting" class="spinner-border spinner-border-sm me-2" aria-hidden="true"></span>
            {{ isEditMode ? 'Güncelle' : 'Kaydet' }}
          </button>
          <button type="button" class="btn btn-secondary ms-2" (click)="cancel()">İptal</button>
        </div>
      </form>
    </div>
  </div>
</div>